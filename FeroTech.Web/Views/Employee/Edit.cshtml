@model FeroTech.Infrastructure.Application.DTOs.EmployeeDto

@{
    ViewData["Title"] = "Edit Employee";

    var departments = ViewBag.Departments
        as IEnumerable<FeroTech.Infrastructure.Application.DTOs.DepartmentDto>
        ?? new List<FeroTech.Infrastructure.Application.DTOs.DepartmentDto>();
}

<div class="edit-employee-page">
    <h2 class="mb-3">Edit Employee</h2>
    <hr />

    <form id="editEmployeeForm">
        <input type="hidden" asp-for="EmployeeId" />

        <div class="row">
            <!-- Full Name -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Full Name</label>
                <input asp-for="FullName" class="form-control" />
                <span asp-validation-for="FullName" class="text-danger"></span>
            </div>

            <!-- Email -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>

            <!-- Phone -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Phone</label>
                <input asp-for="Phone" class="form-control" />
                <span asp-validation-for="Phone" class="text-danger"></span>
            </div>

            <!-- Department -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Department</label>
                <select asp-for="DepartmentId" class="form-select">
                    <option value="">-- Select Department --</option>
                    @foreach (var dept in departments)
                    {
                        <option value="@dept.DepartmentId"
                                selected="@(dept.DepartmentId == Model.DepartmentId)">
                            @dept.DepartmentName
                        </option>
                    }
                </select>
            </div>

            <!-- Job Title -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Job Title</label>
                <input asp-for="JobTitle" class="form-control" />
                <span asp-validation-for="JobTitle" class="text-danger"></span>
            </div>

            <!-- Active -->
            <div class="col-md-6 mb-3 d-flex align-items-center">
                <label class="me-2">Active:</label>
                <input asp-for="IsActive" type="checkbox" class="form-check-input" />
            </div>

            <div class="col-md-12 text-end">
                <button type="submit" class="btn btn-success">
                    <i class="fa fa-save"></i> Save Changes
                </button>
                <a asp-action="Index" class="btn btn-secondary">
                    <i class="fa fa-arrow-left"></i> Back
                </a>
            </div>
        </div>
    </form>
</div>

<style>
    /* Only affect this page content */
    .edit-employee-page h2,
    .edit-employee-page hr,
    .edit-employee-page label,
    .edit-employee-page span,
    .edit-employee-page p {
        color: white !important;
    }

    .edit-employee-page .form-label {
        color: white !important;
    }

    .edit-employee-page label.me-2 {
        color: white !important; /* "Active:" */
    }

    /* Keep validation text red */
    .edit-employee-page .text-danger {
        color: #ff4f4f !important;
    }
</style>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {

            $("#editEmployeeForm").on("submit", function (e) {
                e.preventDefault();

                Swal.fire({
                    title: "Confirm Update",
                    text: "Are you sure you want to update this employee?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, Update"
                }).then((result) => {

                    if (result.isConfirmed) {
                        $.ajax({
                            url: '@Url.Action("Edit", "Employee")',
                            type: "POST",
                            data: $(this).serialize(),
                            success: function (response) {

                                if (response.success) {
                                    Swal.fire({
                                        title: "Updated!",
                                        text: response.message,
                                        icon: "success"
                                    }).then(() => {
                                        window.location.href = '@Url.Action("Index", "Employee")';
                                    });
                                } else {
                                    Swal.fire("Error!", response.message || "Update failed.", "error");
                                }

                            },
                            error: function () {
                                Swal.fire("Error!", "Server error occurred.", "error");
                            }
                        });
                    }

                });
            });

        });
    </script>
}